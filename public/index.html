<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 50px;
                padding-bottom: 20px;
            }
			.todos-container{
				padding-top: 50px;
                padding-bottom: 20px;
			}
        </style>
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#" id="gdgmessage">GDG Vale Eletrônica - TodoApp</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          
        </div><!--/.navbar-collapse -->
      </div>
    </nav>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
        <h1>Firebase</h1>
        <p>O Firebase é uma plataforma móvel que ajuda a desenvolver aplicativos de alta qualidade, expandir sua base de usuários e lucrar mais. O Firebase é composto de recursos complementares que você pode combinar de acordo com suas necessidades.</p>
        <p><a class="btn btn-primary btn-lg" href="https://firebase.google.com/" role="button">Saiba mais sobre o firebase</a></p>
      </div>
    </div>

    <div class="container">
		<div class="row">
			<div class="col-md-12">
				<form id="todoForm">
				  <div class="form-group">
					<label for="todoInput">Todo</label>
					<input type="text" class="form-control" id="todoInput" placeholder="Digite seu todo">
				  </div>
				  <button id="todoFormSubmit" type="submit" class="btn btn-default">Adicionar Todo</button>
				</form>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 todos-container">
				<p>Meus todos:</p>
				<div class="table-responsive">
				  <table class="table table-striped">
					<tbody id="todos"></tbody>
				  </table>
				</div>
			</div>
		</div>
      
	  <footer>
        <p>&copy; GDG Vale Eletrônica 2017 - Feito com <span class="glyphicon glyphicon-heart" aria-hidden="true"></span> por Thiago Coelho</p>
      </footer>
    </div> <!-- /container -->        
	
		<!-- scripts -->
		<script src="js/vendor/bootstrap.min.js"></script>
		<script src="https://www.gstatic.com/firebasejs/3.6.6/firebase.js"></script>
		<script>
		  // Initialize Firebase
			// This code is generated by firebase console
		  var config = {
			apiKey: "AIzaSyChs_k9OzAciBcUgNhE3_4Y_EkyOmfq-Qw",
			authDomain: "gdgtodo-3e3e5.firebaseapp.com",
			databaseURL: "https://gdgtodo-3e3e5.firebaseio.com",
			storageBucket: "gdgtodo-3e3e5.appspot.com",
			messagingSenderId: "54432448061"
		  };
		  firebase.initializeApp(config);

		  // DOM Elements
		  var gdgmessage = document.getElementById('gdgmessage');
		  var todos = document.getElementById('todos');
		  var todoForm = document.getElementById('todoForm');
		  var todoFormSubmit = document.getElementById('todoFormSubmit');
		  var todoInput = document.getElementById('todoInput');
		  
		  // Firebase Real-Time Read
		  firebase.database().ref('gdgmessage').on('value', function(snapshot){
				gdgmessage.innerHTML = snapshot.val();
		  });

		  
		  firebase.database().ref('todos').on('value', function(snapshot){
				// clear todo table
				todos.innerHTML = '';
	
				var data = snapshot.val();

				for(var key in data){
					if (data.hasOwnProperty(key)) {
						todo = data[key].todo ? data[key].todo : '';
						if (todo.trim().length > 0) {
							// create tr and td elements to insert in table
							var tr = document.createElement('tr');
							var td = document.createElement('td');
							td.appendChild(document.createTextNode(todo));
							tr.appendChild(td);
							todos.appendChild(tr);
						}
					}
				}
		  });
		  
		  // Create a new todo
		  function createTodo(pTodo){
				// requestData for firebase
				var requestData = { todo: pTodo };
				return firebase.database().ref().child('todos').push(requestData);
		  }

		  
		  // Form event lister
		  todoFormSubmit.addEventListener('click', function(){
				var todoText = todoInput.value;
				createTodo(todoText);
		  });
		  
		</script>
    </body>
</html>
